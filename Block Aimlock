-- ðŸ“› Aimlock full: Cá»±c ghim + TÃªn + % mÃ¡u + Highlight
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local StarterGui = game:GetService("StarterGui")

local lp = Players.LocalPlayer
local cam = workspace.CurrentCamera

-- ðŸ“Œ GUI Button
local gui = lp:WaitForChild("PlayerGui")
local jumpBtn = gui:FindFirstChild("JumpButton", true)
local button = jumpBtn and jumpBtn:FindFirstChild("BlockButton")

if not button then
	warn("âŒ KhÃ´ng tÃ¬m tháº¥y BlockButton!")
	return
end

-- ðŸ”  Label hiá»ƒn thá»‹ tÃªn + mÃ¡u
local infoLabel = Instance.new("TextLabel")
infoLabel.Size = UDim2.new(0, 300, 0, 30)
infoLabel.Position = UDim2.new(1, -310, 0, 10) -- gÃ³c pháº£i trÃªn
infoLabel.BackgroundTransparency = 1
infoLabel.TextScaled = true
infoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
infoLabel.Font = Enum.Font.SourceSansBold
infoLabel.Visible = false
infoLabel.Parent = gui

-- âš¡ Biáº¿n
local holding = false
local target = nil
local conn = nil
local highlight = nil

-- ðŸ“ Kiá»ƒm tra xem part cÃ³ náº±m trong mÃ n hÃ¬nh khÃ´ng
local function isOnScreen(part)
	if not part then return false end
	local _, onScreen = cam:WorldToViewportPoint(part.Position)
	return onScreen
end

-- ðŸ” TÃ¬m NPC/player gáº§n nháº¥t trong khung hÃ¬nh
local function getClosestTarget()
	local live = workspace:FindFirstChild("Live")
	if not live then return end

	local closest, shortest = nil, math.huge
	for _, model in ipairs(live:GetChildren()) do
		if model:IsA("Model") and model ~= lp.Character and model:FindFirstChild("HumanoidRootPart") and model:FindFirstChild("Humanoid") then
			if model.Humanoid.Health > 0 and isOnScreen(model.HumanoidRootPart) then
				local pos = cam:WorldToViewportPoint(model.HumanoidRootPart.Position)
				local dist = (Vector2.new(pos.X, pos.Y) - Vector2.new(cam.ViewportSize.X/2, cam.ViewportSize.Y/2)).Magnitude
				if dist < shortest then
					shortest = dist
					closest = model
				end
			end
		end
	end
	return closest
end

-- ðŸŽ¯ Báº­t highlight
local function applyHighlight(model)
	if highlight then highlight:Destroy() end
	highlight = Instance.new("Highlight")
	highlight.Adornee = model
	highlight.FillColor = Color3.fromHSV(math.random(), 1, 1)
	highlight.OutlineColor = Color3.new(1, 1, 1)
	highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
	highlight.FillTransparency = 0.3
	highlight.OutlineTransparency = 0
	highlight.Parent = model
end

-- ðŸ”“ Táº¯t highlight
local function removeHighlight()
	if highlight then
		highlight:Destroy()
		highlight = nil
	end
end

-- ðŸ”’ Aim & hiá»‡n thÃ´ng tin
local function lockOn()
	target = getClosestTarget()
	if not target then return end

	applyHighlight(target)
	infoLabel.Visible = true

	conn = RunService.RenderStepped:Connect(function()
		if not target or not target:FindFirstChild("HumanoidRootPart") or not holding then return end

		-- Camera ghim cá»±c nhanh
		cam.CFrame = CFrame.lookAt(cam.CFrame.Position, target.HumanoidRootPart.Position)

		-- Cáº­p nháº­t thÃ´ng tin
		local name = target.Name
		local hp = target:FindFirstChild("Humanoid") and math.floor((target.Humanoid.Health / target.Humanoid.MaxHealth) * 100) or 0
		infoLabel.Text = "ðŸŽ¯ " .. name .. " - " .. hp .. "% HP"
	end)
end

-- ðŸ“´ Ngáº¯t Aimlock
local function unlock()
	if conn then
		conn:Disconnect()
		conn = nil
	end
	removeHighlight()
	infoLabel.Visible = false
	target = nil
end

-- ðŸ“² Gáº¯n vÃ o nÃºt giá»¯ BlockButton
button.MouseButton1Down:Connect(function()
	holding = true
	lockOn()
end)

button.MouseButton1Up:Connect(function()
	holding = false
	unlock()
end)
